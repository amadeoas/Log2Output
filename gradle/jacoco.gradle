// Jacoco test report
test {
	jacoco {
		enabled = true
	}
	finalizedBy jacocoTestReport
}

check.dependsOn jacocoTestCoverageVerification

jacocoTestReport {
	group 'documentation'
	reports {
		xml.required = true
		csv.required = false
		html.destination file("${buildDir}/reports/jacoco/testReport")
	}
	afterEvaluate {
		getClassDirectories().setFrom(files(classDirectories.files.collect {
			fileTree(dir: it, exclude: ['**/uk/co/bocaditos/bootstrap/**'])
		}))
	}
	finalizedBy jacocoTestCoverageVerification
}

jacocoTestCoverageVerification {
	violationRules {
		rule {
			element = 'CLASS'
			limit {
				counter = 'LINE'
				value = 'COVEREDRATIO'
				minimum = .80
			}
			excludes = ['uk.co.bocaditos.bootstrap.*',
				'uk.co.bocaditos.log2xlsx.in.cloud.CloudInput.1',
				'uk.co.bocaditos.log2xlsx.in.jsch.JschInput']
		}
	}
}
